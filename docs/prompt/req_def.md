### 1. システム概要

- システム名: OPUS (Outsourcing Process Unification System)
- 概要: 業務委託先(取引先)情報管理、受発注管理、(主に外部から送られてくる)仕入明細書管理などを行うWebアプリケーション。  
- チーム構成:
  - 私(発案者)
  - あなた(アーキテクト兼PM)
  - AIエージェント(コーディング担当)
- プラットフォーム: TypeScript / Next.js 15 / React を基本とし、最小限のインフラ構成でMVPを開発

### 2. 機能要件

#### 2.1 ユーザー管理

- (FR-1) ログイン/ログアウト機能  
  - ユーザー(社内スタッフ・外部ユーザー問わず)はメールアドレスとパスワードでログインできる。
- (FR-2) パスワードリセット機能  
  - パスワードを忘れたユーザーが自身のメールアドレスにリセット用リンクを送信できる。
- (FR-3) ユーザー権限管理機能  
  - 一般ユーザー → 仕入明細書の承認権限がない、などロールによる機能制限が存在する。
  - 外部ユーザー(フリーランサーなど) → 自身の受注や納品状況を閲覧でき、仕入明細書を受け取った後に確認・承認を行う。

#### 2.2 取引先管理

- (FR-4) 取引先情報の登録/編集/削除  
  - 会社名、メールアドレス、登録番号(インボイス制度での登録番号など)、住所などが対象。
- (FR-5) 取引先の検索/フィルタリング  
  - 取引先名や登録番号を検索キーにフィルタリングできる。
- (FR-6) タグ管理  
  - 特定の取引先にタグをつけて分類したり、一覧でフィルタリングを行える。

#### 2.3 受発注管理

- (FR-7) 発注管理  
  - 発注書作成、取引先選択、品目一覧、数量、単価などを入力できる。  
  - ステータス管理(作成中/発注済み/納品済みなど)によって進捗を追跡。
- (FR-8) 納品管理  
  - 納品に伴う情報(納品日や納品書の簡易データ)を記録する。
- (FR-9) 大量データへの対応  
  - 50件、100件単位で連続して品目を追加するケースのパフォーマンスを検証。

#### 2.4 仕入明細書管理

- (FR-10) 仕入明細書の受領・保存  
  - 外部ユーザー(売り手)が発行することもあるが、本システム側で必要に応じてPDF等でアップロードできるフローを用意。  
  - インボイス制度にも対応（登録番号や税率の取り扱い）。
- (FR-11) 仕入明細書の確認・承認フロー  
  - 仕入明細書の記載内容をチェックし、不備や差異があれば差し戻し。承認後は支払処理を進められる。
- (FR-12) 仕入明細書紐づけ  
  - 発注や納品情報と仕入明細書が正しく対応しているかを一覧画面から確認できる。
- (FR-13) バリデーション  
  - 登録番号フォーマットチェック (「T＋13桁」か？ など)
  - 税率や数量など数値項目の範囲チェック

### 3. 非機能要件

- (NFR-1) パフォーマンス  
  - 主要ページは2秒以内に読み込まれること。  
  - テーブル表示はページネーション対応で大量データにも耐えられる。
- (NFR-2) セキュリティ  
  - HTTPS通信必須  
  - XSS/CSRF対策
  - 権限のないユーザーが管理者機能にアクセスできないこと
- (NFR-3) 可用性  
  - 平日9:00~18:00 は安定稼働が望ましい(暫定)
- (NFR-4) ログ  
  - 主要なCRUD操作は監査ログに記録されることが望ましい

### 4. 画面要件

- ログイン画面  
  - 入力項目: メールアドレス、パスワード  
  - ボタン: ログイン、パスワードリセットへのリンク
- ダッシュボード  
  - 取引先/発注/仕入明細書などのサマリを表示
- 取引先一覧画面  
  - 管理テーブル + 「新規登録」「タグでフィルタ」などの操作
- 発注・納品一覧  
  - テーブル表示 + ページネーション + 並び替え
- 仕入明細書一覧/詳細画面  
  - 仕入明細書に紐づく発注や納品の情報を参照可能
  - 差戻し、承認などのアクションボタンを配置

### 5. データ要件

- 取引先 (Vendor)
  - 必須項目: name, registrationNumber(インボイス登録番号など)  
  - 任意項目: tag, email, phoneNumber, address など
- 発注 (Order)
  - 必須項目: orderNumber, vendorId, issueDate, deliveryDate, など
  - 明細行(items): itemName, quantity, unitPrice, taxRate など
- 仕入明細書 (PurchaseStatement)
  - 必須項目: statementNumber, vendorId, registrationNumber(売り手の登録番号), statementDate, など
  - 明細行(items): itemName, quantity, unitPrice, taxRate など
  - 状態: draft / pending / approved / rejected  
  - ユーザーID(承認した担当者など)を持たせてもよい。

### 6. 運用要件

- ログの保管期間
- データバックアップの頻度
- 運用担当者ごとの権限設定(例: 一般ユーザー、管理者)

### 7. フローチャート図

以下は、OPUSの主要なユーザ操作フロー例。仕入明細書の承認ステップを含む。

mermaid
flowchart TD
A[ログイン画面] --> B[ダッシュボード]
B --> C[取引先一覧]
B --> D[発注/納品一覧]
B --> E[仕入明細書一覧]
E --> F[仕入明細書詳細画面]
F --> G[承認 or 差戻し]

### 8. テストに関する方針 (Cypress統一)

- 単体テストやUIテストも含め、可能な範囲でCypressを利用し統一した検証を行う  
  - 既存のVitestやJest等への移行は原則行わない  
  - E2Eテスト、モックAPIテスト、コンポーネントテストもCypressで実施 (実行負荷・効率は実証しつつ調整)
- .env.test でテスト専用設定を管理し、CI(例: GitHub Actions)と連携して自動化

### 9. 今後の拡張

- MVP完成後、仕入明細書と支払処理のステータス連動なども検討  
- AIエージェントによる自動チェック等の高度化は二次フェーズで検討  
- 先方(外部ユーザー)が手動更新せずとも、電磁的記録やAPI連携でダイレクト承認できるフローを後々拡張予定

---

本ドキュメントの全体方針として、MVPに集中して過剰な複雑化を回避し、短期間で動くプロトタイプを完成させることを目指す。チーム内(発案者・アーキテクト/PM・AIエージェント)でクリアに情報共有しながら、段階的に機能を拡充していく方針だよ。